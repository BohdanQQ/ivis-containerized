<VirtualHost *:80>

    ServerName tapache
    ServerSignature Off

    RewriteEngine On
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,QSA,R=permanent]

    ErrorLog /var/log/apache_ivis_redirect_error.log
    LogLevel warn
</VirtualHost>

 

<VirtualHost *:443>
    ServerName ivis.tapache:443
    
    ErrorLog /var/log/apache_ivis_ssl_error.log
    TransferLog /var/log/apache_ivis_ssl_access.log
    LogLevel warn

    SSLVerifyClient none
    SSLProtocol -all +TLSv1.2
    SSLEngine on

    SSLCertificateFile /opt/server.cert.pem
    SSLCertificateKeyFile /opt/server.key.insecure
    SSLCertificateChainFile /opt/ca.cert.pem
    SSLCACertificateFile /opt/ca.cert.pem

    <Location /clientArea/private>
        SSLVerifyDepth 3
        SSLVerifyClient require
    </Location>

    ProxyPreserveHost On
    ProxyPass "/" "http://ivis:8080/"
    ProxyPassReverse "/" "http://ivis:8080/"
</VirtualHost>

 
# TODO:

# <VirtualHost *:${portSandbox}>
#     ServerName ${hostSandbox}:${portSandbox}

#     ErrorLog ${apacheLogsPath}/${hostSandbox}_ssl_error.log
#     TransferLog ${apacheLogsPath}/${hostSandbox}_ssl_access.log
#     LogLevel warn

#     SSLEngine on
#     SSLCertificateFile ${certificateFile}
#     SSLCertificateKeyFile ${certificateKey}
#     SSLCertificateChainFile ${caChainFile}

#     ProxyPreserveHost On
#     ProxyPass "/" "http://127.0.0.1:8081/"
#     ProxyPassReverse "/" "http://127.0.0.1:8081/"
# </VirtualHost>
# EOT

#     if [ -n "${hostAPI}" ]; then
#         cat >> $apacheConf <<EOT
# <VirtualHost *:${portAPI}>
#     ServerName ${hostAPI}:${portAPI}

#     ErrorLog ${apacheLogsPath}/${hostAPI}_ssl_error.log
#     TransferLog ${apacheLogsPath}/${hostAPI}_ssl_access.log
#     LogLevel warn

#     SSLEngine on
#     SSLCertificateFile ${certificateFile}
#     SSLCertificateKeyFile ${certificateKey}
#     SSLCertificateChainFile ${caChainFile}

#     ProxyPreserveHost On
#     ProxyPass "/" "http://127.0.0.1:8082/"
#     ProxyPassReverse "/" "http://127.0.0.1:8082/"
# </VirtualHost>